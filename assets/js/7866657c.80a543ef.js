"use strict";(self.webpackChunkwebsite_12=self.webpackChunkwebsite_12||[]).push([[7635],{5869:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var s=n(124),i=n(4848),c=n(8453);const r={slug:"esp32-1",title:"\u5173\u4e8eESP32\u63a5\u5165MQTT\u670d\u52a1\u5668\uff08\u57fa\u4e8eOneNet\uff09",authors:"kz152cx",tags:["label1"]},o=void 0,a={authorsImageUrls:[void 0]},l=[{value:"\u6b64\u7bc7\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528ESP32\u63a5\u5165OneNet\u7684MQTT\u670d\u52a1\u5668\u3002",id:"\u6b64\u7bc7\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528esp32\u63a5\u5165onenet\u7684mqtt\u670d\u52a1\u5668",level:2}];function d(e){const t={code:"code",h2:"h2",img:"img",p:"p",pre:"pre",strong:"strong",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"\u6b64\u7bc7\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528esp32\u63a5\u5165onenet\u7684mqtt\u670d\u52a1\u5668",children:"\u6b64\u7bc7\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528ESP32\u63a5\u5165OneNet\u7684MQTT\u670d\u52a1\u5668\u3002"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"\u4e8b\u524d\u51c6\u5907\uff1a\u7a0b\u5e8f\u9700\u8981WiFi\u5e93\u51fd\u6570\u4ee5\u53caPubSubClient\u5e93\u51fd\u6570\uff0c\u53ef\u5728library\u4e2d\u76f4\u63a5\u4e0b\u8f7d\uff0c\u968f\u5373\u5728\u4e3b\u51fd\u6570\u5934\u6587\u4ef6\u4e0a\u58f0\u660e"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-md",children:"#include <WiFi.h>         //wifi\u5e93\u51fd\u6570\n#include <WiFiClient.h>   //wifi\u5e93\u51fd\u6570\n#include <PubSubClient.h> //MQTT\u534f\u8bae \u5e93\u51fd\u6570 \u7528\u4e8e\u8fde\u63a5onenet\u7269\u8054\u7f51\u5e73\u53f0\n"})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"1.\u6ce8\u518cOneNet\u5e73\u53f0\u8d26\u6237"}),"\n",(0,i.jsx)(t.img,{alt:"\u7ba1\u7406\u5458\u754c\u9762",src:n(2648).A+"",width:"1335",height:"822"}),"\n",(0,i.jsx)(t.strong,{children:"2.\u521b\u5efa\u4ea7\u54c1\uff0c\u968f\u5373\u5728\u8bbe\u5907\u7ba1\u7406\u4e2d\u521b\u5efa\u8bbe\u5907\uff0c\u5e76\u4f7f\u7528\u6570\u636e\u6d41\u6a21\u5f0f\uff0c\u63a5\u5165\u534f\u8bae\u91c7\u7528MQTT\u534f\u8bae"}),"\n",(0,i.jsx)(t.img,{alt:"\u8bbe\u5907\u7ba1\u7406\u754c\u9762",src:n(5223).A+"",width:"1457",height:"677"}),"\n",(0,i.jsx)(t.strong,{children:"3.\u83b7\u53d6\u8bbe\u5907ID\u548cAPIKEY\uff0c\u5728\u5b98\u65b9\u63a8\u51fa\u7684token\u8ba1\u7b97\u5de5\u5177\u4e2d\u8ba1\u7b97token"})]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"4.\u5728\u7a0b\u5e8f\u90e8\u5206\u58f0\u660e\u76f8\u5173\u4fe1\u606f"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-md",children:'const char* mqtt_server = "183.230.4.96";   //onenet \u670d\u52a1\u7aefip\u5730\u5740\nconst int port = 1883 ;         //\u7aef\u53e3\u53f7\nconst char* mqtt_pubid = "id";  //\u4ea7\u54c1ID\nconst char* mqtt_devid = "project";     //\u4ea7\u54c1\u540d\u79f0\nconst char* mqtt_password = "token"; \n'})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"5.\u521b\u5efa\u4e00\u4e2aPubSub\u5ba2\u6237\u7aef"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-md",children:"WiFiClient wc;\nPubSubClient pc(wc); // \u521b\u5efa\u4e00\u4e2aPubSub\u5ba2\u6237\u7aef, \u4f20\u5165\u521b\u5efa\u7684WIFI\u5ba2\u6237\u7aef\n"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"6.\u6267\u884cMQTT\u670d\u52a1\u5668\u8fde\u63a5"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-md",children:'  pc.setServer("183.230.40.96",1883);//\u8bbe\u7f6e\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u670d\u52a1\u5668,\u8fde\u63a5Onenet\u670d\u52a1\u5668, \u4f7f\u75281883\u7aef\u53e3\n  pc.connect(mqtt_devid, mqtt_pubid, mqtt_password);\n'})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"7.\u53d1\u5e03\u6570\u636e"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-md",children:'   String payload = "{\\"id\\": 123,\\"dp\\": {\\"temperature\\": [{\\"v\\": " + String(temperature) + "}]}}";\n   \u6784\u9020\u5b8c\u6574\u7684topic\u8def\u5f84\n   String topic = "$sys/project_id/\u9879\u76ee\u540d\u79f0/dp/post/json";\n   pc.publish(topic.c_str(), payload.c_str());\n   String payload0 = "{\\"id\\": 123,\\"dp\\": {\\"humidity\\": [{\\"v\\": " + String(humidity) + "}]}}";\n   \u6784\u9020\u5b8c\u6574\u7684topic\u8def\u5f84\n   String topic0 = "$sys/project_id/\u9879\u76ee\u540d\u79f0/dp/post/json";\n   pc.publish(topic0.c_str(), payload0.c_str());\n'})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"8.\u6ce8\u610f\u4fdd\u6301MQTT\u5fc3\u8df3"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-md",children:"  pc.setKeepAlive(5);\n  pc.loop();\n"})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.img,{src:n(2570).A+"",width:"1214",height:"617"}),"\n\u4f7f\u7528\u5e73\u53f0\u6570\u636e\u9762\u677f\u67e5\u770b\u5355\u7247\u673a\u4e0a\u4f20\u7684\u6570\u636e"]})]})}function p(e={}){const{wrapper:t}={...(0,c.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},2648:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/p1-d72a0f6fe8ff136dbab74eb94e62d2a1.jpg"},5223:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/p2-3bffd719f6efd5bb1ab33ede19123d8e.jpg"},2570:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/p3-472fa0b2924681aaae9281cf999e0b99.jpg"},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var s=n(6540);const i={},c=s.createContext(i);function r(e){const t=s.useContext(c);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(c.Provider,{value:t},e.children)}},124:e=>{e.exports=JSON.parse('{"permalink":"/blog/esp32-1","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2024-12-20-esp32.md","source":"@site/blog/2024-12-20-esp32.md","title":"\u5173\u4e8eESP32\u63a5\u5165MQTT\u670d\u52a1\u5668\uff08\u57fa\u4e8eOneNet\uff09","description":"\u6b64\u7bc7\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528ESP32\u63a5\u5165OneNet\u7684MQTT\u670d\u52a1\u5668\u3002","date":"2024-12-20T00:00:00.000Z","tags":[{"inline":false,"label":"esp32","permalink":"/blog/tags/label1","description":"esp32\u5f00\u53d1\u677f"}],"readingTime":1.98,"hasTruncateMarker":false,"authors":[{"name":"\u5c0f\u8f89\u732b","title":"Embedded Systems Developer @ China","url":"https://github.com/kz152cx","page":{"permalink":"/blog/authors/kz-152-cx"},"socials":{"x":"https://x.com/kz152cx","github":"https://github.com/kz152cx","linkedin":"https://www.linkedin.com/in/xiaohuimao/","newsletter":"https://thisweekinreact.com"},"imageURL":"/img/ico.jpg","key":"kz152cx"}],"frontMatter":{"slug":"esp32-1","title":"\u5173\u4e8eESP32\u63a5\u5165MQTT\u670d\u52a1\u5668\uff08\u57fa\u4e8eOneNet\uff09","authors":"kz152cx","tags":["label1"]},"unlisted":false,"nextItem":{"title":"\u5173\u4e8eESP\u7cfb\u5217\u5904\u7406\u5668\u8fde\u63a5TFT\u5c4f","permalink":"/blog/esp32-2"}}')}}]);